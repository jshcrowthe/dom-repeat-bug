<!DOCTYPE html>
<html>
<head>
  <title>Polymer 1.0 Demo</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
  <script>
    if ('registerElement' in document               &&
        'createShadowRoot' in HTMLElement.prototype &&
        'import' in document.createElement('link')  &&
        'content' in document.createElement('template')) {
      console.log("Using WC Enabled Browser");
    } else {
      document.write('<script src="components/webcomponentsjs/webcomponents-lite.js"><\/script>');
    }
  </script>
  <link rel="import" href="components/polymer/polymer.html">
  <link rel="import" href="components/iron-ajax/iron-ajax.html">
  <link rel="import" href="components/pokemon-card/pokemon-card.html">
  <style>
    pokemon-card {
      margin-bottom:10px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="row">
    <h1>Polymer 1.0 Demo</h1>
  </div>
  <div class="row">
    <template id="pokemon-list" is='dom-bind'>
      <!-- Request Pokemon -->
      <iron-ajax
       auto
       url="http://pokeapi.co/api/v1/pokemon?limit=15"
       method="GET"
       handleAs="json"
       on-response="_getTypes"
       last-response="{{data}}"></iron-ajax>
      <p>
        <label>Type:</label>
        <select value="{{type::change}}">
          <template is="dom-repeat" items="{{types}}" as="type">
            <option value="[[type]]">[[type]]</option>
          </template>
        </select>
      </p>
      <p><label>Name:</label><input type="text" value="{{name::input}}"></p>
      <template is="dom-repeat" items="{{data.objects}}" as='pokemon' filter="{{_filter(type, name)}}">
        <pokemon-card pokemon="{{pokemon}}" data-index='{{index}}'></pokemon-card>
      </template>
    </template>
  </div>
</div>

<script>
  var el = document.querySelector('#pokemon-list');
  el.type = 'all';
  el.name = '';
  el.types = ['all'];
  el._getTypes = function(event, resObj) {
    if (!resObj || !resObj.response || !Array.isArray(resObj.response.objects)) return;
    resObj.response.objects.forEach(function(obj) {
      if (!obj || !Array.isArray(obj.types)) return;
      if (!~el.types.indexOf(obj.types[0].name)) el.push('types', obj.types[0].name);
    }); 
  };
  el._filter = function(type, nameFilter) {
    var advFilter = function(filterStatus, val) {
      if (!filterStatus) return false;
      if (!nameFilter) return true;
      nameFilter = nameFilter.toLowerCase();
      return val.name && ~val.name.toLowerCase().indexOf(nameFilter);
    };
    return function(val) {
      if (!type || type === 'all') return advFilter(true, val);
      return advFilter(val.types[0].name.toLowerCase() === type, val);
    };
  };
</script>

</body>
</html>

